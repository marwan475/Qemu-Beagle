(()=>{"use strict";!function(t){let e;try{e=window.localStorage,window.localStorage.removeItem("url-root"),window.localStorage.removeItem("standard-login")}catch(n){e=window.sessionStorage,t.warn(String(n))}const n=e.getItem("shell:style");let o;window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"auto"===n||"dark"===n?document.documentElement.classList.add("pf-theme-dark"):document.documentElement.classList.remove("pf-theme-dark"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>{t.matches&&"auto"===n||"dark"===n?document.documentElement.classList.add("pf-theme-dark"):document.documentElement.classList.remove("pf-theme-dark")}));const i=window.environment||{},s=i.OAuth||null;s&&(s.TokenParam||(s.TokenParam="access_token"),s.ErrorParam||(s.ErrorParam="error_description"));const r=/\$\{([^}]+)\}|\$([a-zA-Z0-9_]+)/g;function a(t){const e=Array.prototype.slice.call(arguments,1);return t.replace(r,(function(t,n,o){return e[n||o]||""}))}function c(t){if(window.cockpit_po){const e=window.cockpit_po[t];if(e&&e[1])return e[1]}return t}const l=c;let d,u,p,g;const f=/[?&]?([^=]+)=([^&]*)/g;let w=null;function m(t){t=t.split("+").join(" ");const e={};for(;;){const n=f.exec(t);if(!n)break;e[decodeURIComponent(n[1])]=decodeURIComponent(n[2])}return e}function h(t){return document.getElementById(t)}function v(t,e){"string"==typeof t&&(t=[t]);for(let n=0;n<t.length;n++)if("string"==typeof t[n]){const o=document.querySelectorAll(t[n]);o&&o.forEach((function(t){t.hidden!==!!e&&(t.hidden=!!e)}))}else t[n].hidden!==!!e&&(t[n].hidden=!!e)}function k(){v(arguments,!1)}function y(){v(arguments,!0)}function x(e){window.console&&t.warn("fatal:",e),y("#login-again","#login-wait-validating"),w&&(h("login-again").href=w,k("#login-again")),y("#login","#login-details"),k("#login-fatal");const n=h("login-fatal-message");n.textContent="",n.appendChild(document.createTextNode(e))}function b(t,e){const n=h(t),o=n&&window.getComputedStyle?window.getComputedStyle(n,":before"):null;if(!o)return;let i=o.content;if(i&&"none"!=i&&"normal"!=i){const t=i.length;('"'===i[0]||"'"===i[0])&&t>2&&i[t-1]===i[0]&&(i=i.substr(1,t-2)),n.innerHTML=i||e}else n.removeAttribute("class")}function C(){function e(e,n){"supports"===e&&(e="@supports API");const o=a(l("This web browser is too old to run the Web Console (missing $0)"),e);window.console&&t.warn(o),h("login-error-message").textContent=o,k("#unsupported-browser","#error-group"),document.body.classList.add("unsupported-browser"),function(t){t?(k("#login","#login-details","#login-override"),y("#get-out-link"),h("login-override-content").appendChild(h("login")),h("login-button").classList.add("pf-m-warning"),document.querySelector("#login .login-actions").insertAdjacentHTML("beforebegin","<div class='pf-c-helper-text pf-m-warning' id='bypass-warning'>"+l("Cockpit might not render correctly in your browser")+"</div>")):y("#login","#login-details","#login-override")}(n)}function n(t,n){let o;try{o=n&&n[t]}catch(e){throw x(a(l("The web browser configuration prevents Cockpit from running (inaccessible $0)"),t)),e}return void 0!==o||(e(t),!1)}function o(){const t=[].join.call(arguments,": ");return!(!window.CSS||!window.CSS.supports.apply(this,arguments))||(e(t,"bypass"),!1)}return!!(n("WebSocket",window)&&n("XMLHttpRequest",window)&&n("sessionStorage",window)&&n("JSON",window)&&n("defineProperty",Object)&&n("console",window)&&n("pushState",window.history)&&n("textContent",document)&&n("replaceAll",String.prototype)&&n("finally",Promise.prototype)&&n("supports",window.CSS))&&(o("display","flex")&&o("display","grid")&&o("selector(test)")&&o("selector(:is(*):where(*))"),!0)}function S(t){return t.replace(/^\s+|\s+$/g,"")}function L(t){const n=document.createElement("a"),s=document.baseURI;t=t||"/",n.href=s,"/"!=n.pathname&&(o=n.pathname.replace(/^\/+|\/+$/g,""),e.setItem("url-root",o),o&&0===t.indexOf("/"+o)&&(t=t.replace("/"+o,"")||"/")),0===t.indexOf("/=")?(i.hostname=t.substring(2).split("/")[0],h("server-field").value=i.hostname,I(null,!0),t="/cockpit+"+t.split("/")[1]):0!==t.indexOf("/cockpit/")&&0!==t.indexOf("/cockpit+")&&(t="/cockpit"),u=t.split("/")[1],d="/"+u+"/login",o&&(d="/"+o+d),g=u,p=d}function I(t,e){t&&"keypress"===t.type&&" "!==t.key||(t&&"click"===t.type&&t.preventDefault(),void 0===e&&(e=h("server-group").hidden),v("#server-group",!e),h("option-group").setAttribute("data-state",e))}function E(t){const e=h("login-password-input");e.setAttribute("type","password"===e.getAttribute("type")?"text":"password"),t.stopPropagation()}function T(){const t=window.location.href.split("#",2);w=s.URL,s.URL.indexOf("?")>-1?w+="&":w+="?",w+="redirect_uri="+encodeURIComponent(t[0])}function _(){y("#error-group"),h("login-error-message").textContent=""}function O(){y("#info-group"),h("login-info-message").textContent=""}function A(t,e){_(),t&&(s?x(t):($(e||"login"),h("login-error-message").textContent=t,k("#error-group")))}function R(t){h("server-field").value?(_(),h("login-error-message").textContent=t,k("#error-group"),I(null,!0),$("login")):A(t)}function U(){return i.page.require_host&&-1===g.indexOf("cockpit+=")}function H(){let n=[];try{n=JSON.parse(e.getItem("cockpit-client-sessions")||"[]")}catch(e){t.log("Failed to parse 'cockpit-client-sessions':",e)}return n}function N(){A(null);const t=S(h("login-user-input").value);if(""!==t||i.is_cockpit_client)if(U()&&""===h("server-field").value)A(l("Please specify the host to connect to"));else{const n=h("server-field").value;n?(u="cockpit+="+n,d=p.replace("/"+g+"/","/"+u+"/"),h("brand").style.display="none",h("badge").style.visibility="hidden"):(u=g,d=p,b("badge",""),b("brand","Cockpit")),h("server-name").textContent=n||i.hostname,h("login-button").removeEventListener("click",N);const o=h("login-password-input").value,s="superuser:"+t+(n?":"+n:""),r=e.getItem(s)||"none";e.setItem("superuser-key",s),e.setItem(s,r),e.setItem("standard-login",!0);const a={Authorization:"Basic "+window.btoa(W(t+":"+o)),"X-Superuser":r};n&&(a["X-SSH-Connect-Unknown-Hosts"]="yes"),G("GET",a,!1)}else A(l("User name cannot be empty"))}function P(){const t=H(),n=h("recent-hosts-list");n.innerHTML="",t.forEach((o=>{const i=document.createElement("div");i.classList.add("host-line");const s=document.createElement("button");s.textContent=o,s.classList.add("pf-c-button","pf-m-tertiary","host-name"),s.addEventListener("click",(()=>{h("server-field").value=o,N()}));const r=document.createElement("button");r.title=l("Remove host"),r.ariaLabel=r.title,r.classList.add("host-remove"),r.addEventListener("click",(()=>{const n=t.indexOf(o);t.splice(n,1),e.setItem("cockpit-client-sessions",JSON.stringify(t)),P()})),i.append(s,r),n.append(i)})),v("#recent-hosts",0==t.length)}function $(t){const e=i.page.connect;let n=h("option-group").getAttribute("data-state");if(y("#login-wait-validating"),k("#login"),v("#login-details",i.is_cockpit_client),v("#server-field-label",i.is_cockpit_client),i.is_cockpit_client){const t=h("brand");t.textContent=l("Connect to:"),t.classList.add("text-brand")}v(["#user-group","#password-group"],"login"!=t||i.is_cockpit_client),v("#conversation-group","conversation"!=t),v("#hostkey-group","hostkey"!=t),h("login-button-text").textContent=l("hostkey"==t?"Accept key and log in":"Log in"),"login"!=t&&(h("login-password-input").value=""),i.page.require_host?(y("#option-group"),n=!0):v("#option-group",!e||"login"!=t),e&&"login"==t?v("#server-group",!n):y("#server-group"),h("login-button").removeAttribute("disabled"),h("login-button").removeAttribute("spinning"),h("login-button").classList.remove("pf-m-danger"),h("login-button").classList.add("pf-m-primary"),y("#get-out-link"),"login"==t&&h("login-button").addEventListener("click",N),i.is_cockpit_client&&(P(),document.body.classList.add("cockpit-client"))}function q(t){var e;e=t,O(),e&&(h("login-info-message").textContent=e,k("#info-group")),h("server-name").textContent=document.title,function(t){const e=h("login-note");t?(k(e),e.textContent=t):e.innerHTML="&nbsp;"}(l("Log in with your server user account.")),h("login-user-input").addEventListener("keydown",(function(t){A(null),O(),13==t.which&&h("login-password-input").focus()}),!1);h("login-password-input").addEventListener("keydown",(function(t){A(null),13==t.which&&N()})),h("login-password-toggle").addEventListener("click",E),$("login"),i.is_cockpit_client?i.page.require_host&&h("server-field").focus():h("login-user-input").focus()}function J(n){const o=function(){try{return JSON.parse(e.getItem("known_hosts")||"{ }")}catch(e){return t.warn("Can't parse known_hosts database in localStorage",e),{}}}(),i=n["host-key"],s=i.split(" ")[0],r=i.split(" ")[1];o[s]!=i?(o[s]?(h("hostkey-title").textContent=a(l("$0 key changed"),h("server-field").value),k("#hostkey-warning-group"),h("hostkey-message-1").textContent=""):(h("hostkey-title").textContent=l("New host"),y("#hostkey-warning-group"),h("hostkey-message-1").textContent=a(l("You are connecting to $0 for the first time."),h("server-field").value)),h("hostkey-verify-help-1").textContent=a(l("To verify a fingerprint, run the following on $0 while physically sitting at the machine or through a trusted network:"),h("server-field").value),h("hostkey-verify-help-cmds").textContent=a("ssh-keyscan$0 localhost | ssh-keygen -lf -",r?" -t "+r:""),h("hostkey-fingerprint").textContent=n.default,r?(h("hostkey-type").textContent=a("($0)",r),k("#hostkey-type")):y("#hostkey-type"),A(""),h("login-button").addEventListener("click",(function r(){h("login-button").removeEventListener("click",r),A(null,"hostkey"),o[s]=i,function(n){try{e.setItem("known_hosts",JSON.stringify(n))}catch(e){t.warn("Can't write known_hosts database to localStorage",e)}}(o),j(n.id,n.default)})),$("hostkey"),k("#get-out-link"),o[s]&&(h("login-button").classList.add("pf-m-danger"),h("login-button").classList.remove("pf-m-primary"))):j(n.id,n.default)}function M(t){if(t["host-key"])return void J(t);const e=t.echo?"text":"password";h("conversation-prompt").textContent=t.prompt;const n=h("conversation-message"),o=t.error||t.message;o?(n.textContent=o,k(n)):y(n);const i=h("conversation-input");function s(){h("conversation-input").removeEventListener("keydown",r),h("login-button").removeEventListener("click",s),A(null,"conversation"),j(t.id,h("conversation-input").value)}function r(t){A(null,"conversation"),13==t.which&&s()}i.value="",t.default&&(i.value=t.default),i.setAttribute("type",e),A(""),h("conversation-input").addEventListener("keydown",r),h("login-button").addEventListener("click",s),$("conversation"),i.focus()}function W(t){return window.unescape(encodeURIComponent(t))}function X(e,n){if(!e)return null;const o=e.split(" ");if("x-conversation"!==o[0].toLowerCase()&&3!=o.length)return null;const i=o[1];let s,r;try{s=window.atob(o[2])}catch(e){return window.console&&t.error("Invalid prompt data",e),null}try{r=JSON.parse(n)}catch(e){window.console&&t.log("Got invalid JSON response for prompt data",e),r={}}return r.id=i,r.prompt=s,r}function G(e,n,o){h("login-button").setAttribute("disabled","true"),h("login-button").setAttribute("spinning","true");const i=new XMLHttpRequest;i.open(e,d,!0);for(const t in n)i.setRequestHeader(t,n[t]);i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){B(JSON.parse(i.responseText))}else if(401==i.status){const e=i.getResponseHeader("WWW-Authenticate");if(e&&0===e.toLowerCase().indexOf("x-conversation")){const t=X(e,i.responseText);t?M(t):x(l("Internal error: Invalid challenge header"))}else if(window.console&&t.log(i.statusText),i.statusText.startsWith("captured-stderr:"))!function(e){window.console&&t.warn("stderr:",e),y("#login-wait-validating"),y("#login","#login-details"),k("#login-fatal"),h("login-again").onclick=()=>{y("#login-fatal"),q()},k("#login-again");const n=h("login-fatal-message");n.textContent="",n.appendChild(document.createTextNode(e))}(decodeURIComponent(i.statusText.replace(/^captured-stderr:/,"")));else if(i.statusText.indexOf("authentication-not-supported")>-1){const t=S(h("login-user-input").value);x(a(l("The server refused to authenticate '$0' using password authentication, and no other supported authentication methods are available."),t))}else i.statusText.indexOf("terminated")>-1?A(l("Authentication failed: Server closed connection")):i.statusText.indexOf("no-host")>-1?R(l("Unable to connect to that address")):i.statusText.indexOf("unknown-hostkey")>-1?R(l("Refusing to connect. Hostkey is unknown")):i.statusText.indexOf("unknown-host")>-1?R(l("Refusing to connect. Host is unknown")):i.statusText.indexOf("invalid-hostkey")>-1?R(l("Refusing to connect. Hostkey does not match")):A(l(o?"Authentication failed":"Wrong user name or password"))}else 403==i.status?A(l(decodeURIComponent(i.statusText))||l("Permission denied")):i.statusText?x(decodeURIComponent(i.statusText)):x(a(l("$0 error"),i.status))},i.send()}function j(t,e){G("GET",{Authorization:"X-Conversation "+t+" "+window.btoa(W(e))},!0)}function z(t,e,n){let o=0;for(;o<t.length;){const i=t.key(o);n&&0!==i.indexOf("cockpit")||0===i.indexOf(e)?t.removeItem(i):o++}}function B(t){let n=window.sessionStorage.getItem("login-wanted");const s=h("server-field").value;if(s&&i.is_cockpit_client){const t=H();t.indexOf(s)<0&&(t.push(s),e.setItem("cockpit-client-sessions",JSON.stringify(t)))}s&&u!=g&&(n="/="+s,o&&(n="/"+o+n)),z(window.sessionStorage,u,!1),function(t){if(z(window.sessionStorage,u,!0),e.removeItem("login-data"),z(e,u,!1),t&&t["login-data"]){const n=JSON.stringify(t["login-data"]);e.setItem(u+"login-data",n),e.setItem("login-data",n)}o&&e.setItem("url-root",o);const n=i.CACertUrl;n&&window.sessionStorage.setItem("CACertUrl",n)}(t),function(t){let e=window.setTimeout((function(){e=null,window.location.reload(!0)}),100);t&&t!=window.location.href&&(window.location=t),window.onbeforeunload=function(){e&&window.clearTimeout(e),e=null}}(n)}t||(t=function(){}),window.onload=function(){window.onload=null,function(){if(!document.querySelectorAll)return;const t=document.querySelectorAll("[translate]");for(let e=0;e<t.length;e++)t[e].textContent=c(t[e].textContent)}(),window.cockpit_po&&window.cockpit_po[""]&&(document.documentElement.lang=window.cockpit_po[""].language,window.cockpit_po[""]["language-direction"]&&(document.documentElement.dir=window.cockpit_po[""]["language-direction"])),L(window.location.pathname),0!==window.location.pathname.indexOf("/"+o+"/cockpit/")&&0!==window.location.pathname.indexOf("/"+o+"/cockpit+")||document.documentElement.setAttribute("class","inline");let t=i.page.title;if(i.is_cockpit_client&&(t=l("Login")),t&&0!==u.indexOf("cockpit+=")||(t=i.hostname),document.title=t,0===u.indexOf("cockpit+=")?y("#brand","#badge"):(b("badge",""),b("brand","Cockpit")),!C())return;i.banner&&(k("#banner"),h("banner-message").textContent=i.banner.trimEnd()),h("show-other-login-options").addEventListener("click",I),h("show-other-login-options").addEventListener("keypress",I),h("server-clear").addEventListener("click",(function(){const t=h("server-field");t.value="",t.focus()}));const e="explicit"==window.sessionStorage.getItem("logout-intent");e&&window.sessionStorage.removeItem("logout-intent");const n=window.sessionStorage.getItem("logout-reason");n&&window.sessionStorage.removeItem("logout-reason"),s?(y("#login-details","#login"),e?(T(),h("login-again").textContent=l("Login again"),x(l("Logout successful"))):function(){const t=document.createElement("a");if(!s.URL)return x(l("Cockpit authentication is configured incorrectly."));const e=!window.location.search&&window.location.hash?m(window.location.hash.slice(1)):m(window.location.search);if(T(),e[s.TokenParam]){window.sessionStorage.getItem("login-wanted")&&(t.href=window.sessionStorage.getItem("login-wanted"),L(t.pathname));const n=e[s.TokenParam];k("#login-wait-validating");const o=new XMLHttpRequest;o.open("GET",d,!0),o.setRequestHeader("Authorization","Bearer "+n),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status)B(JSON.parse(o.responseText));else{const t=X(o.getResponseHeader("WWW-Authenticate"),o.responseText);t?M(t):x(decodeURIComponent(o.statusText))}},o.send()}else e[s.ErrorParam]?x(e[s.ErrorParam]):(window.sessionStorage.setItem("login-wanted",window.location.href),window.location=w)}()):e?q(n):U()?q():function(){const t=new XMLHttpRequest;t.open("GET",d,!0),t.onreadystatechange=function(){4==t.readyState&&(200==t.status?B(JSON.parse(t.responseText)):401==t.status?q():t.statusText?x(decodeURIComponent(t.statusText)):0===t.status?q():x(a(l("$0 error"),t.status)))},t.send()}()}}(window.console)})();